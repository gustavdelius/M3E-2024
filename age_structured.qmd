# Age-structured population model

## Continuous time model

In the previous chapter we structured the population by a discrete variable, the sex of the individuals. This gave rise to a system of coupled ODEs, one ODE for each class of individuals. In this section we will structure the population by a continuous variable, the age of the individuals. This will give rise to a partial differential equation (PDE) for the age-dependent population density. We will solve this PDE and study the long-term behaviour of the population and its age distribution.

So instead of describing the population just by the total number of individuals $N(t)$, we will describe it by the density $n(t,a)$ of individuals at age $a$. The total number $N(t)$ of individuals in the population  is then given by the integral of $n(at,a)$ over all ages. More generally, the total number of individuals in the population that are between age $a_1$ and $a_2$ is given by the integral of $n(t,a)$ over the interval $[a_1,a_2]$. You are familiar with the concept of density from probability theory, where continuous random variables are described by a probability density rather than a probability. You may also be familiar with the concept from physics, where the density of a material describes how the mass is distributed over space. Here, the density $n(t,a)$ describes how the individuals are distributed over ages.

To derive the PDE for the age-structured population density, we consider how the density changes over an infinitesimal time interval $\delta t$ due to deaths:
$$
n(t+\delta t, a+\delta t) = n(t,a) - \mu(a) n(t,a) \delta t.
$$ {#eq-a1}
Note how we had to take into account that over the time interval $\delta t$ the age of the individuals has increased by $\delta t$. We now Taylor-expand the left-hand side around $t$ and $a$:
$$
n(t+\delta t, a+\delta t) = n(t,a) + \frac{\partial n}{\partial t} \delta t + \frac{\partial n}{\partial a} \delta t + \mathcal{O}(\delta t^2).
$$ {#eq-a2}
Cancelling the $n(t,a)$ terms on both sides and dividing by $\delta t$ gives us the PDE for the age-structured population density:
$$
\frac{\partial n}{\partial t} + \frac{\partial n}{\partial a} = -\mu(a) n.
$$ {#eq-a3}

This equation captures the effect of individuals aging and dying, but it does not capture how they are born. Individuals are born with age $0$. These offspring can be produced by parents of any ages, but with an age-dependent rate $b(a)$. This gives
$$
n(t,0) = \int_0^\infty b(a) n(t,a) \, da.
$$ {#eq-a4}
This is a boundary condition for the PDE. It says that the density of individuals at age $0$ is given by the total number of offspring produced by the individuals of all ages. 

We will now solve the PDE for the age-structured population density by the method of separation of variables. We will make the Ansatz $n(t,a) = f(t) r(a)$. You have seen this trick for finding solutions of linear, homogeneous PDEs in other modules, like Waves and Fluids for example. Substituting this Ansatz into the PDE gives
$$
f'(t) r(a) + f(t) r'(a) = -\mu(a) f(t) r(a).
$$ {#eq-a5}
Dividing by $f(t) r(a)$ gives
$$
\frac{f'(t)}{f(t)} + \frac{r'(a)}{r(a)} = -\mu(a).
$$ {#eq-a6}
We now collect all terms that depend on $t$ on the left-hand side and all terms that depend on $a$ on the right-hand side:
$$
\frac{f'(t)}{f(t)} = - \frac{r'(a)}{r(a)} - \mu(a).
$$ {#eq-a7}
Because the left-hand side is independent of $a$ and the right-hand side is independent of $t$, both sides must be equal to a constant. We introduce the separation constant $\gamma$ and write
$$
\frac{f'(t)}{f(t)} = \gamma, \quad \frac{r'(a)}{r(a)} = -\gamma - \mu(a).
$$ {#eq-a8}
These are now linear ODEs and hence easy to solve. The first ODE has the solution 
$$
f(t) = f(0) e^{\gamma t}
$$ {#eq-a9}
and the second ODE has the solution
$$
r(a) = r(0) \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right).
$$  {#eq-a10}

So altogether we have the population density
$$
n(t,a) = n(0,0) e^{\gamma t} \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right),
$$ {#eq-a11}
where $n(0,0)=f(0)r(0)$ is the initial density of individuals at age $0$. 

So far we don't yet know the value of the separation constant $\gamma$. This will be determined by the boundary condition. If we substitute the solution @eq-a11 into the boundary condition @eq-a4, we get
$$
n(0,0)e^{\gamma t} = \int_0^\infty b(a) n(0,0)e^{\gamma t} \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right)\, da.
$$ {#eq-a12}
We can cancel the common factor $n(0,0)e^{\gamma t}$ on both sides to get the condition
$$
1= \int_0^\infty b(a) \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right) \, da = \phi(\gamma).
$$ {#eq-a13}
We have introduced the shorthand notation $\phi(\gamma)$ for the integral on the right-hand side. The condition @eq-a12 is a transcendental equation for $\gamma$. We cannot solve it analytically for $\gamma$. But we observe that $\phi$ is a monotonically decreasing function of $\gamma$. This observation alone allows us to make a statement about the sign of $\gamma$. According to @eq-a9 the sign of $\gamma$ determines whether the total population grows expnentially or goes extinct.

If $\gamma$ is positive, then the monotonicity of $\phi$ tells us that $\phi(0) > \phi(\gamma)  = 1$ and vice versa. Conversely, if $\gamma$ is negative, then $\phi(0) < \phi(\gamma) = 1$ and vice versa. So to determine the sign of $\gamma$ we only have to look at the value of
$$
\phi(0) = \int_0^\infty b(a) \exp\left(-\int_0^a \mu(a') \, da'\right)\, da.
$$ {#eq-a14}

* If $\phi(0) > 1$, then  $\gamma > 0$ and the population grows exponentially.

* If $\phi(0) < 1$, then $\gamma < 0$ and the population goes extinct.

This result actually has a very intuitive explanation. The factor
$$
\exp\left(-\int_0^a \mu(a') \, da'\right)=:l(a)
$$ {#eq-a15}
is the probability that an individual survives up to age $a$. Therefore $\phi(0)$ is the expected number of offspring produced by an individual during its lifetime. If this number is greater than $1$, then the population grows exponentially. If it is less than $1$, then the population goes extinct.


## Discrete time model

In the continuous-time age-structured population model discussed in the previous section we had assumed that births take place continuously through time. If however reproduction is an annual event, taking place in a short breeding season for example, then it is more natural to model the population in discrete time. We will now derive the discrete-time version of the age-structured population model and then study the long-term behaviour of the population and its age distribution.

### Model description

Both time and age will be discrete variables. We will take them to be integers counting years. We will describe the population by the numbers $N_{a,t}$ of individuals of age $a$ at time $t$. The total number $N_t$ of individuals in the population at time $t$ is then given by the sum of $N_{a,t}$ over all ages.

The parameters of our model will be the probabilities $S_a$ of surviving from age $a-1$ to age $a$ and the number of offspring $b_a$ produced by an individual when they reach age $a$. Because the number of individuals at age $a$ at time $t+1$ is the number of individuals that a year earlier were at age $a-1$ and have survived to age $a$, we have
$$
N_{a,t+1} = S_{a} N_{a-1,t}.
$$ {#eq-a16}
When individuals reach age $a$, they each produce $b_a$ offspring. The total number of offspring produced at time $t$ is therefore given by
$$
N_{0,t} = \sum_{a=1}^\infty b_a N_{a,t}.
$$ {#eq-a17}
This is a boundary condition for the discrete-time model. It says that the number of individuals at age $0$ at time $t$ is given by the total number of offspring produced by the individuals of all ages at time $t$. This is the discrete-time analogue of the boundary condition @eq-a4 for the continuous-time model.

Note that in @eq-a17 both sides of the equation are at time $t$. That is because reproduction is taken to happen instantaneously at time $t$. It is conventional to use @eq-a16 to rewrite the boundary condition @eq-a17 as an equation for $N_{0,t+1}$:
$$
N_{0,t+1} = \sum_{a=1}^\infty b_a N_{a,t+1}= \sum_{a=1}^\infty b_a S_{a} N_{a-1,t}
= \sum_{a=1}^\infty F_a N_{a-1,t},
$$ {#eq-a18}
where we have introduced the fecundity $F_a:=b_a S_a$.

@eq-a16 and @eq-a18 are the equations for the discrete-time age-structured population model. They are a system of coupled difference equations, one equation for each age class. We would like to solve them to determine the numbers $N_{a,t}$ of individuals at each age at each time. Notice that @eq-a16 looks very simple and we could use it to determine $N_{a,t}$ for $a=1,2,3,\ldots$ in terms of $N_{0,t}$,
$$
\begin{split}
N_{a,t} &= S_{a} N_{a-1,t} = S_{a} S_{a-1} N_{a-2,t} = \cdots \\
&= S_aS_{a-1}\cdots S_1 N_{0,t}
= l_{a} N_{0,t},
\end{split}
$$ {#eq-ac18}
where we used that the product $S_aS_{a-1}\cdots S_1$ is the probability of surviving from age $0$ to age $a$, which we denote by $l_a$. However @eq-a18 spoils the game because it tells us that we won't know $N_{0,t}$ until we know $N_{a,t}$ for all ages $a$. This is a typical feature of age-structured population models. The number of individuals at age $0$ at time $t$ depends on the number of individuals at all other ages at time $t$. Solving both @eq-a16 and @eq-a18 together is a non-trivial task.

### Stable age distribution
In analogy to the continuous-time model, we will now look for a solution of the form
$$
N_{a,t} = \lambda^t r(a)
$$ {#eq-ab19}
This is a solution in which the age distribution $r(a)$ remains stable from one year to the next, but the total population grows or shrinks by a factor $\lambda$ each year. 
This means in particular that for this solution $N_{a,t+1} = \lambda N_{a,t}$ for all ages $a$. For $a=1$ this gives
$$
N_{1,t+1} = \lambda N_{1,t} = S_1 N_{0,t}
$$ {#eq-a23}
and hence
$$
N_{1,t} = \frac{S_1}{\lambda} N_{0,t}.
$$ {#eq-a24}
Similarly we can express $N_{2,t}$ in terms of $N_{0,t}$:
$$
N_{2,t} = \frac{S_2}{\lambda} N_{1,t} = \frac{S_1 S_2}{\lambda^2} N_{0,t}.
$$ {#eq-a25}
We can continue this process to express $N_{a,t}$ in terms of $N_{0,t}$:
$$
N_{a,t} = \frac{S_1 S_2 \cdots S_{a}}{\lambda^a} N_{0,t}= \frac{l_{a}}{\lambda^a} N_{0,t}.
$$ {#eq-a26}


Finally, for the newborns we have
$$
N_{0,t+1} = \lambda N_{0,t} = \sum_{a=1}^M F_a N_{a-1,t} = \sum_{a=1}^M F_a \frac{l_{a-1}}{\lambda^{a-1}} N_{0,t}.
$$ {#eq-a27}
Dividing the equation by $\lambda N_{0,t}$ gives
$$
1 = \sum_{a=1}^M F_a\frac{l_{a-1}}{\lambda^a}.
$$ {#eq-a28}
Using that $F_a = b_a S_a$ and $S_al_{a-1}=l_a$ we can rewrite this equation as
$$
1 = \sum_{a=1}^M b_a \,l_a\,\lambda^{-a} =:\psi(\lambda).
$$ {#eq-a29}
This is the Euler-Lotka equation for the stable age distribution. Compare it to the corresponding equation for the continuous-time model @eq-a13 with $e^{\gamma}=\lambda$. The only difference is that the continuous-time model has an integral over age, while the discrete-time model has a sum over age.

By the same argument as in the continuous case we can see that if the expected number of offspring produced by an individual during its lifetime, $\sum_{a=1}^M b_a \,l_a=\psi(1)$, is greater than $1$ then the population grows exponentially. If it is less than $1$, then the population goes extinct.

We will now determine the stable age distribution for a specific example.

::: {#exm-spotted_owl}
For the spotted owl the age-dependent reproduction numbers are
$$
b_a = \begin{cases}
0 & \text{if } a < 2, \\
b & \text{if } a \geq 2
\end{cases}
$$ {#eq-a30}
for some constant $b$. The age-dependent survival probabilities are
$$
S_a = \begin{cases}
1 & \text{if } a = 1, \\
l & \text{if } a = 2, \\
p & \text{if } a > 2
\end{cases}
$$ {#eq-a31}
for some constants $l$ and $p$. Those values of the survival probabilities from year to year lead to the following values of the survival probabilities from birth to age $a$:
$$
l_a = \begin{cases}
1 & \text{if } a = 1, \\
l\, p^{a-2} & \text{if } a \geq 2.
\end{cases}
$$ {#eq-a32}
Substituting these values into the expression for $\psi(\lambda)$ in @eq-a29 gives
$$
\begin{split}
\psi(\lambda) &= b l \sum_{a=2}^\infty p^{a-2} \lambda^{-a} = lb\lambda^{-2}\sum_{n=0}^\infty \frac{p}{\lambda}\\
&= lb\lambda^{-2}\frac{1}{1-\frac{p}{\lambda}}
=\frac{lb}{\lambda(\lambda-p)},
\end{split}
$$ {#eq-a33}
where we made use of the formula for a geometric series, valid if $|p/\lambda|<1$ ^[If $\lambda\geq p$, then $\psi(\lambda)$ diverges and does not satisfy the Euler-Lotka equation $\psi(\lambda)=1$.]. 
In particular, the expected number of offspring produced by an individual in their lifetime is $$
\psi(1)=lb/(1-p).
$$
If this is greater than $1$, then the population grows exponentially. If it is less than $1$, then the population goes extinct.


In this case the Euler-Lotka equation $\psi(\lambda)=1$ becomes the quadratic equation for $\lambda$:
$$
\psi(\lambda)=\frac{lb}{\lambda(\lambda-p)}=1 \quad \Leftrightarrow \quad \lambda^2 - \lambda p - lb = 0.
$$ {#eq-a34}
The solutions are
$$
\lambda_\pm = \frac{p \pm \sqrt{p^2 + 4lb}}{2}.
$$ {#eq-a35}
We are interested in the positive solution $\lambda_+$. 
Substituting this value for $\lambda$ back into @eq-a26 and @eq-ab19 we see that we have found the solution
$$
N_{a,t} = \left(\frac{p + \sqrt{p^2 + 4lb}}{2}\right)^{t-a}l_a N_{0,0}
$$ {#eq-a36}
for any choice of $N_{0,0}$.

:::




<!----
In the case where there is a maximal age $M$, we can collect the equations for $N_{a,t+1}$ for $a=0,1,2,\ldots,M-1$ (@eq-a16 and @eq-a18) into a matrix equation:

$$
\begin{pmatrix}
N_{0} \\
N_{1} \\
N_{2} \\
\vdots \\
N_{M-1}
\end{pmatrix}_{t+1}
=
\begin{pmatrix}
F_1 & F_2 & \cdots & F_{M-1} & F_M \\
S_1 & 0 & \cdots & 0 & 0 \\
0 & S_2 & \cdots & 0 & 0 \\
\vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & \cdots & S_{M-1} & 0
\end{pmatrix}
\begin{pmatrix}
N_{0} \\
N_{1} \\
N_{2} \\
\vdots \\
N_{M-1}
\end{pmatrix}_{t}.
$$ {#eq-a19}

Note that we did not include the equation for $N_{M,t+1}$ in the matrix equation. This is because individuals at age $M$ are assumed to die at the end of the year before they get a chance to reproduce, hence they do not contribute back to the other age classes. Once the matrix equation @eq-a19 is solved, we can determine $N_{M,t+1}$ separately from @eq-a16 if we are interested.

The matrix on the right-hand side of @eq-a19 is a so-called Leslie matrix. Let us denote it by $L$. The equation @eq-a19 is a matrix equation of the form
$$
\mathbf{N}_{t+1} = L\, \mathbf{N}_t,
$$ {#eq-a20}
where $\mathbf{N}_t$ is the column vector of the numbers $N_{a,t}$ and $L$ is the Leslie matrix. 

In this notation it is easy to formally write down the solution:
$$
\mathbf{N}_t = L^t \mathbf{N}_0.
$$ {#eq-a21}


Next we want to look at the stable age distribution of the population. This is a distribution of the population over ages that remains unchanged from one year to the next. It is the distribution that the population will eventually settle into, no matter what the initial distribution was. The total population may still change by a factor $\lambda$ each year, but this factor changes the population at all ages equally. This stable age distribution therefore has to satisfy the equation
$$
\mathbf{N}_{t+1} = L\, \mathbf{N}_t = \lambda\,\mathbf{N}_{t},
$$ {#eq-a22}
In other words, it is an eigenvector of the Leslie matrix with real eigenvalue $\lambda$.


---->

## Exercises

#### * Age-independent rates
::: {#exr-age_structured}
In the continuous-time age-structured population model consider the case where $b(a)=b$
and $\mu(a)=\mu$ are both constant. Repeat all steps of the analysis but simplifying the expressions at each step by using the constant values for birth and death rates.

1. Solve the partial differential
equation of the age-structured model by making the Ansatz $n(t,a)=f(t)r(a)$ and introducing the separation constant $\gamma$.
2. Use the boundary condition at $a=0$ to determine the value of $\gamma$.
3. Give the condition under which the population goes extinct and compare it to the condition in the exponential model from chapter 1.
:::

#### o Harvestings an age-structured population
::: {#exr-age_harvesting}
Consider an age-structured fish population in which all individuals above the maturity age $a_m$ are reproducing, at a fixed rate, so that
$$
b(a) = \begin{cases}
0 & \text{if } a < a_m, \\
b & \text{if } a \geq a_m.
\end{cases}
$$ {#eq-age_harvesting_1}
All fish at all ages experience a natural death rate $\mu_0$. In addition, fish above the maturity size are harvested at a constant rate $\mu_F$, so that
$$
\mu(a) = \begin{cases}
\mu_0 & \text{if } a < a_m, \\
\mu_0 + \mu_F & \text{if } a \geq a_m.
\end{cases}
$$ {#eq-age_harvesting_2}
By calculating the expected number of offspring per individual, determine the limit on the harvesting rate $\mu_F$ that allows the population to be sustainable.
:::

<!----
#### o Leslie matrix
::: {#exr-leslie}
Consider the Leslie matrix
$$
L = \begin{pmatrix}
0 & 2 & 0 \\
0.5 & 0 & 0 \\
0 & 0.5 & 0
\end{pmatrix}.
$$ {#eq-leslie}

1. Calculate the stable age distribution of the population.
2. Calculate the growth rate of the population.
:::

#### o Leslie matrix with harvesting
::: {#exr-leslie_harvesting}
Consider the Leslie matrix
$$
L = \begin{pmatrix}
0 & 2 & 0 \\
0.5 & 0 & 0 \\
0 & 0.5 & 0
\end{pmatrix}.
$$ {#eq-leslie_harvesting}
Now assume that the population is harvested at a constant rate $\mu_F$ at all ages. The harvesting rate is such that
$$
\mu(a) = \begin{cases}
\mu_0 & \text{if } a < a_m, \\
\mu_0 + \mu_F & \text{if } a \geq a_m.
\end{cases}
$$ {#eq-leslie_harvesting_2}
Calculate the stable age distribution of the population and the growth rate of the population.
:::

#### o Leslie matrix with age-independent rates
::: {#exr-leslie_age_independent}
Consider the Leslie matrix
$$
L = \begin{pmatrix}
0 & 2 & 0 \\
0.5 & 0 & 0 \\
0 & 0.5 & 0
\end{pmatrix}.
$$ {#eq-leslie_age_independent}
Now assume that the birth and death rates are constant, so that
$$
b(a) = b, \quad \mu(a) = \mu.
$$ {#eq-leslie_age_independent_2}
Calculate the stable age distribution of the population and the growth rate of the population.
:::

#### Eastern Screech Owl
::: {#exr-owl}
The Eastern Screech Owl is a small owl that is found in the eastern United States and Canada. It is a cavity-nesting bird, which means that it nests in holes in trees. The Eastern Screech Owl has a lifespan of about 10 years. It reaches maturity at 1 year and has a clutch size of 3-5 eggs. The Eastern Screech Owl is a nocturnal bird and feeds on small mammals, birds, and insects. It is a common bird in its range and is not considered to be threatened.

| Age | Suburban     |           | Rural        |           |
| --- | ------------ | --------- | ------------ | --------- |
| $a$ |   $l_a$      |   $m_a$   |   $l_a$      |   $m_a$   |
| 0   | 1.00         | 0.0       | 1.00         | 0.0       |
| 1   | 0.49         | 0.8       | 0.30         | 0.8       |
| 2   | 0.18         | 1.3       | 0.11         | 1.1       |
| 3   | 0.10         | 1.5       | 0.06         | 1.6       |
| 4   | 0.06         | 1.6       | 0.04         | 1.0       |
| 5   | 0.04         | 1.3       | 0.02         | 1.0       |
| 6   | 0.03         | 1.3       |              |           |
| 7   | 0.02         | 1.3       |              |           |
| 8   | 0.02         | 1.3       |              |           |
| 9   | 0.01         | 1.3       |              |           |
| 10  | 0.01         | 1.3       |              |           |

1. Use the Leslie matrix model to calculate the stable age distribution of the Eastern Screech Owl population.
2. Calculate the growth rate of the Eastern Screech Owl population.
:::

---->