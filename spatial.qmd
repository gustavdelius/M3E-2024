# Spatially-structured populations

We now want to keep track of how individuals are distributed over space. So instead of describing a population by its total number of individuals $N(t)$ we describe it by a population density $u(x,t)$, where $u(x,t)dx$ is the number of individuals in the interval $[x,x+dx]$ at time $t$. We can recover the total number of individuals by integrating the density over the entire spatial domain.

## Derivation of PDE
In the non-spatial case we described the time evolution of the population by the equation
$$
\frac{dN}{dt} = f(N),
$$ {#eq-nonspatial}
where $f(N)$ is the net growth rate that encodes the difference between birth and death rates for the population as a whole. In the spatial case we have to consider the net growth rate of the population in a small interval $[x,x+dx]$. This is again given by a function $f$ that encodes the births and deaths, but now we also have  movement of individuals into or out of the interval. We write the rate of change of the number of individuals in the interval as
$$\begin{multline}
\frac{\partial}{\partial t}\int_{x_0}^{x_0+\Delta x}u(x,t)dx = 
\int_{x_0}^{x_0+\Delta x}f(u(x,t),x)dx\\ +J(x_0)-J(x_0+\Delta x).
\end{multline}$$ {#eq-spatial}
The flux $J(x)$ is defined as the net rate at which individuals move through point $x$ from left to right. If more individuals move from right to left than from left to right, the flux is negative. We have indicated explicitly that $f$ can depend on both the population density $u$ at $x$ as well as the position $x$ itself. This is because the birth and death rates can depend on the local environment, for example the availability of resources or the presence of predators. The flux $J$ can also depend on the local population density and the position. We did not indicate this explicitly to simplify the notation.

We now use the integral mean value theorem that states that for a continuous function $g(x)$ the integral over $g(x)$ over an interval $[a,b]$ is equal to $g(\xi)(b-a)$ for some $\xi\in[a,b]$. We apply this to the integrals in @eq-spatial to get
$$
\partial_t u(\xi_1,t)\Delta x = f(u(\xi_2,t),\xi_2)\Delta x +J(x_0)-J(x_0+\Delta x)
$$ {#eq-spatial2}
for some $\xi_1,\xi_2\in[x_0,x_0+\Delta x]$. We now divide both sides by $\Delta x$,
$$
\partial_t u(\xi_1,t) = f(u(\xi_2,t),\xi_2) x +\frac{J(x_0)-J(x_0+\Delta x)}{\Delta x}
$$ {#eq-spatial3}
and take the limit $\Delta x\to 0$, where $\xi_1\to x$ and $\xi_2\to x$ and the difference quotient becomes the derivative, to get
$$
\partial_t u(x,t) = f(u(x,t),x)-\partial_x J(x).
$$  {#eq-transport}

As discussed above, the flux $J$ can depend on $x$ both directly and through the population density $u(x,t)$. An important example is the case where the flux is proportional to the gradient of the population density, 
$$
J(x) = -D\partial_x u(x),
$$ {#eq-diffusion_flux}
where $D$ is the diffusion coefficient. This models random motion of the individuals. Each individual is equally likely to move right or left, but if there are more individuals on the left and less on the right, then the result is a net movement to the right. That is why the flux has the opposite sign of the gradient of the density. 

This random motion gives us the reaction-diffusion equation
$$
\partial_t u=f(u)+D\,\partial_x^2 u.
$$ {#eq-rd}
If there is no local population dynamics, the equation simplifies to the diffusion equation, also known as the heat equation. The diffusion term has the effect of smoothing out spatial inhomogeneities in the population density. Therefore the heat equation by itself is rather boring. However, as we will see later, the reaction term in combination with the diffusion term can lead to the formation of spatial patterns, such as travelling waves or stationary patterns.

## Fishing model with diffusion

We now consider a model for a population of fish that is subject to fishing and that moves around randomly. We want to model a marine protected area where fishing is limited to avoid a collapse of the fish population. @fig-mpa shows the spatial setup. The $x$-axis runs perpendicular to the shore at $x=0$. A marine protected area runs out upto a distance $L$ from the shore. We assume that the marine protected area has infinite extension in the $y$-direction, so that we can ignore the $y$-coordinate and model the fish population as a function of $x$ only.

Beyond $x=L$ there is no management of the fishing activity. We assume that the fishers are so efficient that they catch all fish that venture outside the protected area. So we set $u(x,t)=0$ for $x\geq L$. This is of course an idealisation, but it allows us to focus on the dynamics within the protected area. 

![Sketch of the marine protected area](figures/Spatial/mpa.svg){width=70%, #fig-mpa}


We assume that in the absence of fishing the population has a logistic growth rate. The population density $u(x,t)$ satisfies the equation
$$
\partial_t u = r u \left(1-\frac{u}{K}\right) - E u + D \partial_x^2 u,
$$ {#eq-fish}
where $r$ is the intrinsic growth rate, $K$ is the carrying capacity, $E$ is the fishing rate and $D$ is the diffusion coefficient. The first term on the right-hand side describes the logistic growth, the second term the fishing and the third term the random motion of the fish.

In the protected area, the fishing rate $E$ must certainly be below the intrinsic growth rate $r$, otherwise the population is guaranteed to die out. However we must also take into account that some fish will be lost when they randomly move out of the protected area, where they are fished immediately. We expect this effect to be larger when the protected area is smaller. So when the marine protected area is planned, there will be a trade-off between the width $L$ of the protected area and the allowed rate of fishing $E$. Our aim is to describe this trade-off precisely by finding the condition on $E$ and $L$ such that the population does not collapse.

To achieve our aim, we will need to solve the PDE. But before solving a PDE we always need to be clear about the boundary conditions on the solution. We have already discussed that we assume that $u(x,t)=0$ for $x\geq L$, i.e., we have a Dirichlet boundary condition at $x=L$. At $x=0$ we impose a no-flux boundary condition, which means that there are no fish moving from the sea onto the shore or the other way around. This is a reasonable assumption if the shore is a steep cliff or a sandy beach where fish cannot live. The no-flux boundary condition is the Neumann boundary condition $\partial_x u(0,t) = 0$.

The PDE @eq-fish is a nonlinear PDE, so we cannot solve it analytically in general. However, we can still make progress by realising that before the population goes extinct, it will get small. We can then linearise the PDE around the extinction state $u=0$ and solve the linearised equation. If the extinction steady state is linearly unstable, then the population will not go extinct.

Linearising the PDE @eq-fish around the extinction state $u=0$ means that we neglect the term $u^2$ in the logistic growth term. We then have the linearised equation
$$
\partial_t u = (r - E)u + D \partial_x^2 u.
$$ {#eq-fishlin}
We can now solve this linear PDE with the method of separation of variables. We make the Ansatz $u(x,t) = X(x)T(t)$ and plug this into @eq-fishlin. We get
$$
XT'=(r-E)XT+DX''T
$$ {#eq-fishsep}
and after dividing by $XT$ we get
$$
\frac{T'}{T} = r-E + D \frac{X''}{X}.
$$ {#eq-fishsep2}
The left-hand side depends only on $t$ and the right-hand side only on $x$. Therefore both sides must be equal to a constant, which we call $gamma$. We then have the two ODEs
$$
T' = \gamma T, ~~~ X'' = \frac{\gamma-r+E}{D}X =:-\rho^2 X,
$$ {#eq-fishsep3}
where, in order to save writing, we have defined 
$$
\rho^2 = (r-E-\gamma)/D.
$$ {#eq-fishrho}
The solution of the time ODE is 
$$
T(t) = T(0)e^{\gamma t}
$$ {#eq-fishT}
and the solution of the spatial ODE is 
$$
X(x) = A \cos(\rho x) + B \sin(\rho x),
$$ {#eq-fishX}
where $A$ and $B$ are constants to be determined by the boundary conditions.

Imposing the no-flux boundary condition $\partial_xu(0,t)$ gives 
$$
X'(0) =-A\rho\sin(\rho 0)+B\rho\cos(\rho 0)=B\rho= 0.
$$ {#eq-fishBC1}
So either $\rho=0$ or $B=0$. The case $\rho=0$ gives the trivial solution $X(x)=A$, which is not interesting. So we take $B=0$ and get $X(x) = A\cos(\rho x)$. 

The Dirichlet boundary condition at $x=L$ gives $X(L) = A\cos(\rho L) = 0$. So either $A=0$ or $\cos(\rho L) = 0$. The former gives rise to the zero solution, so we want the latter, which requires $\rho L$ to be an odd multiple of $\pi/2$, i.e.,
$$
\rho=\rho_n = \frac{(2n+1)\pi}{2L}
$$  {#eq-fishrho2}
for $n=0,1,2,...$. To each of these $\rho_n$ there corresponds, according to @eq-fishrho, a 
$$
\gamma_n = r-E-D\rho_n^2
$$  {#eq-fishgamma}
and a solution 
$$
u_n(x,t) = X_n(x)T_n(t) = A_ne^{\gamma_n t}\cos(\rho_n x)
$$ {#eq-fishsol}
The general solution is then a linear combination of these solutions,
$$
u(x,t) = \sum_{n=0}^\infty A_ne^{\gamma_n t}\cos(\rho_n x).
$$ {#eq-fishgensol}

The condition for the population not to go extinct is that the extinction steady state is linearly unstable. This means that there is at least one $\gamma_n$ with positive real part. We see from @eq-fishgamma that $\gamma_n$ increases with $n$. So the condition for the population not to go extinct is that $\gamma_0$ is positive. This gives the condition
$$
\gamma_0=r-E-D\rho_0^2=r-E-\frac{D\pi^2}{4L^2}>0.
$$ {#eq-fishcond}
We can now solve this inequality for $L$ to get the condition on the width of the marine protected area that ensures the population does not collapse.
$$
L>\frac{\pi}{2}\sqrt{\frac{D}{r-E}}.
$$ {#eq-fishcond2}
Alternatively we can solve the inequality for $E$ to get the condition on the fishing rate that ensures the population does not collapse.
$$
E<r-\frac{D\pi^2}{4L^2}.
$$ {#eq-fishcond3}
This can now be used to inform policy decisions on the width of the marine protected area and the allowed fishing rate.


## Invasion waves in SIR model

We now want to use our spatial modelling skills to study the spread of an infectious disease through space. For concreteness think of a situation where rabies has infected foxes in Dover and we want to get an idea of how soon we will have rabid foxes in York. We model the fox population by the SIR model, where $S(x,t)$ is the density of susceptible foxes, $I(x,t)$ is the density of infected foxes and $R(x,t)$ is the density of removed foxes. So where in @sec-sir we had ordinary differential equations for the total number of susceptible, infected and removed foxes, we now have partial differential equations for the densities of susceptible, infected and removed foxes in space.

While foxes are usually very territorial and stay in their own territory, infected foxes become a bit insane and move around randomly. This is modelled by a diffusion term in the equation for the infected foxes. The equations are
$$\begin{split}
\partial_t S&=-\beta \frac{SI}{N},\\
\partial_t I&=\beta \frac{SI}{N}-\gamma I+D\partial_x^2I,\\
\partial_t R&=\gamma I,
\end{split}$$ {#eq-sir}
where $N=S+I+R$ is the total fox population, $\beta$ is the infection rate, $\gamma$ is the recovery rate and $D$ is the diffusion coefficient. For simplicity we study the movement in the $x$ direction only. The above equations are valid for all $x$. We will later concentrate on the equations for $I$ and $S$ only, as $R$ can then be calculated from $N=S+I+R$.

Before analysing these equations further, let us think about what we expect to happen. 
The infected foxes in Dover will infect more and more susceptible foxes. The infected foxes will then move around and infect susceptible foxes in neighbouring territories. This will lead to a wave of infection spreading out from Dover. The wave will move at a speed that depends on the infection rate, the recovery rate and the diffusion coefficient. The wave will have a front where the infected foxes are and a tail where the infected foxes have recovered and are immune.

To make the further analysis easier, we will non-dimensionalise the equations. We introduce the non-dimensional variables
$$
u = S/N, ~~~ v = I/N,~~~ \tilde{t} = \beta t,
$$ {#eq-sirnondim}
Then the equations become
$$\begin{split}
\partial_{\tilde{t}} u&=-uv\\
\partial_{\tilde{t}} v&=uv-\frac{\gamma}{\beta}v+\frac{D}{\beta}\partial_x^2v.
\end{split}$$ {#eq-sirnondim2}
We now also introduce the non-dimensional spatial variable $\tilde{x} = \sqrt{\frac{\beta}{D}}x$ and the non-dimensional parameter $r = \frac{\gamma}{\beta}$.
We now drop the tildes to avoid clutter and write the equations as
$$\begin{split}
\partial_t u&=-uv\\
\partial_t v&=uv-rv+\partial_x^2v.
\end{split}$$ {#eq-sirnondim3}

We are looking for a solution describing the spread of the infection from Dover to York. We make the Ansatz that the solution is a travelling wave, i.e., that it is of the form
$$
u(x,t)=U(z),~~~v(x,t)=V(z)
$$ {#eq-sirnondim4}
with $z=x-ct$ for some $c>0$. This means that the wave is a right-moving wave. We plug this into the equations and get the system of ODEs
$$\begin{split}
-cU'&=-UV\\
-cV'&=UV-rV+V''.
\end{split}$$ {#eq-sirnondim5}
Next let us think about the boundary conditions. We expect that the solution will be $u=1$ and $v=0$ for $z\to\infty$ because ahead of the wave all individuals are still susceptible and there are no infecteds yet. Behind the wave the epidemic will have run its course and so $u=S_\infty/N=:a$ and $v=0$ for $z\to-\infty$. In other words, the travelling wave interpolates between the state before an epidemic (at $z=\infty$) and the state after an epidemic (at $\=-\infty$). We also have that the solution becomes flat at $z\to-\infty$, so in particular $V'(\pm\infty)=0$.

We now massage the equations a bit to get them into a form that we can integrate more easily. From the first equation we see that $UV=cU'$ and also that $V=cU'/U=c(\log U)'$. We plug this into the second equation and get
$$
-cV'=cU'-rc(\log U)' + V''.
$$ {#eq-sirnondim6}
Now that each term in the equation is a total derivative, we can integrate it by just removing the differentiations:
$$
-cV=cU-rc\log U + V'+A,
$$ {#eq-sirnondim7}
where $A$ is a constant of integration. We use the boundary condition at $z\to\infty$ to determine $A$:
$$
0=c-rc\log 1 + 0 + A \Rightarrow A=-c.
$$ {#eq-sirnondim8}
At $z\to-\infty$ we get
$$
0=ca-rc\log a + 0 - c \Rightarrow a-1=r\log a.
$$ {#eq-sirnondim9}
This equation is equivalent to @eq-Sinf for $S_\infty$ in the case where $S_0=N$. Again this transcendental equation can only be solved numerically.

Next we want to determine the wave speed $c$. We do this by linearising the equation around the leading edge of the wave where $V$ is very small and $U$ is close to 1, i.e, $U=1-\epsilon$ for small $\epsilon$. Substituting this into the second equation in [-@eq-sirnondim5] we get
$$
-cV' = (1-\epsilon)V - r V + V''.
$$
Because both $\epsilon$ and $V$ are small, we can neglect the product $\epsilon V$ and get
$$
-cV' = (1 - r) V + V''.
$$
This is a linear ODE with constant coefficients and can thus be solved with the Ansatz $V(z) = e^{-\lambda z}$. Substituting this into the ODE and dividing by $e^{-\lambda z}$ gives
$$
\lambda^2 -c\lambda+ 1-r=0.
$$
The solution of this quadratic equation is
$$
\lambda = \frac{c\pm\sqrt{c^2-4(1-r)}}{2}.
$$
We need $\lambda$ to be real, so we need the discriminant to be non-negative, i.e.,
$$
c^2-4(1-r)\geq 0
$$
and thus we get a lower bound on the wave speed:
$$
c\geq 2\sqrt{1-r}.
$$




## Turing instabilities

## Directed motion

## Exercises
#### Fishing model with diffusion
::: {#exr-fish}
<!--- From Exam 2020 --->
A population of fish $F(x,t)$ in a river of width $L$ with banks at $x=0$ and $x=L$ can be modelled by the partial differential equation
$$
\frac{\partial F}{\partial t} = rF\left( 1-\frac{F}{K} \right) + D\frac{\partial^2 F}{\partial x^2},
$$ {#eq-fish}
where $r$, $K$ and $D$ are positive constants.
No-flux boundary conditions are applied at $x=L$.  At precisely $x=0$ some shore-based fishermen catch all of the fish.  We wish to find the minimum width of the river to ensure the fish population does not collapse.

1. First determine the spatially uniform steady states and indicate their stability.

2. Linearise the system for small $F$.

3. By considering a solution of the form $F(x,t) = e^{\lambda t} \left( A \cos kx + B \sin kx \right)$ show that 
$$
\lambda = \lambda_n =: r-k_n^2D,
$$ {#eq-fishlambda}
where
$$
k = k_n =: \frac{(2n+1)\pi }{2L}, ~~~ n = 0,~1,~2,...
$$ 

4. Hence, determine the condition on $L$ for the fish population not to collapse.

:::

----------------------------------------------------------------------

#### Travelling wave in 1-species reaction-diffusion model
::: {#exr-spatial1}
<!--- From sheet 4 --->
A reaction-diffusion population model has the form
$$
\frac{\partial u}{\partial t}=f(u)+D\frac{\partial^2u}{\partial x^2}
$$ {#eq-rd1}
where $D>0$ and where $f$ satisfies $f(0)=f(1)=0$ and $f(u)>0$ for
$u\in(0,1)$. 

a) Convert this equation into travelling wave form by making the
Ansatz that $u(x,t)=U(z)$ and $v(x,t)=V(z)$ with $z=x-ct$.

b) Assuming
that a solution exists such that $U(-\infty)=1$, $U(\infty)=0$ show, by
linearising the equation at the leading edge,
that for a biologically realistic solution the wave speed $c$ satisfies
$c\geq 2\sqrt{Df'(0)}$.

c) Suppose that, instead, $f(u)=0$. Show that the equation in travelling
wave form becomes $DU''+c\,U'=0$.  Give the general solution of
this. Does the solution look realistic for a function that represents
a population?
:::

----------------------------------------------------------------------

#### * Travelling wave in 2-species reaction-diffusion model
::: {#exr-spatial2}
<!--- From sheet 4 --->
Consider the system
$$
\begin{split}
\frac{\partial u}{\partial t}&=-u^2v \\
\frac{\partial v}{\partial t}&=u^2v-\rho
v+\frac{\partial^2v}{\partial x^2}
\end{split}
$$ {#eq-rd2}
where $\rho$ is a positive constant. 
Convert this system into travelling wave form
by making the
Ansatz that $u(x,t)=U(z)$ and $v(x,t)=V(z)$ with $z=x-ct$, and show in particular that
$$
-c\frac{dV}{dz}=c\frac{dU}{dz}-\frac{\rho
  c}{U^2}\frac{dU}{dz}+\frac{d^2V}{dz^2}.
$$ {#eq-rd3}
Consider a solution of the travelling wave equations
such that $U(\infty)=1$, $U(-\infty)=a$, $V(\pm\infty)=0$ for some $a<1$.
By integrating the above equation from $-\infty$ to
$\infty$ and imposing the boundary conditions, determine 
 the value of $a$. Also determine a lower bound on the
wave velocity $c$ by linearising around the leading edge of the
wave.
:::

----------------------------------------------------------------------

#### SIR model with logistic growth
::: {#exr-spatial3}
<!--- From sheet 4 --->
Assume that in the absence of rabies, the fox population is described by a
logistic model with intrinsic growth rate $r$ and carrying capacity $K$.
Adding this population dynamics to the SIR model gives the equations
$$\begin{split}
\partial_t S&=rS\left(1-\frac{S}{K}\right)-\beta SI\\
\partial_t I&=\beta SI-\gamma I.
\end{split}$$ {#eq-sirlogistic}
We ignore the removed component $R$, which in this case would correspond to
dead foxes.


a) Show that this model can be written in non-dimensionalised
form as
$$\begin{split}
\partial_{\tilde{t}} u&=bu(1-u)-uv\\
\partial_{\tilde{t}} v&=uv-mv.
\end{split}$$ {#eq-sirlogistic2}

b) Determine the steady state solutions (fixed points). Under
what condition on the parameters is there an endemic state?

Now assume that both susceptible and infected foxes move around randomly,
but at different rates. This adds diffusion terms to the SIR model, where now
$S=S(x,t)$ and $I=I(x,t)$ denote densities in space.
$$\begin{split}
\partial_t S&=rS\left(1-\frac{S}{K}\right)-\beta SI+D_1\partial_x^2S\\\
\partial_t I&=\beta SI-\gamma I+D_2\partial_x^2I.
\end{split}$$ {#eq-sirlogistic3}

c) Give expressions for $\tilde{x}$ and $d$ such that this model can be written in non-dimensionalised
form as
$$\begin{split}
\partial_{\tilde{t}} u&=bu(1-u)-uv+\partial_{\tilde{x}}^2u\\
\partial_{\tilde{t}} v&=uv-m v+d\,\partial_{\tilde{x}}^2v
\end{split}$$ {#eq-sirlogistic4}

We will now work with these non-dimensional equations but drop the tildes to avoid clutter.

d) Make the travelling wave Ansatz
$$
u(x,t)=A(z),~~~v(x,t)=B(z)
$$ {#eq-sirlogistic5}
with $z=x-ct$ for some $c>0$
and derive the system of ODEs describing the functions $A$ and $B$. 

e) If $A(\infty)=1$, what are $A(-\infty), B(\infty)$ and $B(-\infty)$? Make a sketch of $A(z)$
and $B(z)$ and indicate the direction of travel with an arrow. 

f) By linearising about the leading edge of the wave where $B$ is
very small, determine a lower limit on the wave speed $c$.

:::

----------------------------------------------------------------------

#### Derive Turing instability
::: {#exr-spatial4}
Consider the reaction-diffusion model
$$\begin{split}
\frac{\partial u}{\partial t}&=a-u+u^2v+D_1\frac{\partial^2u}{\partial
  x^2} \\
\frac{\partial v}{\partial t}&=b-u^2v+D_2\frac{\partial^2v}{\partial
  x^2}
\end{split}$$ {#eq-ex_turing}
where $b>0$ and $a+b>0$.

Show that a spatially uniform steady state solution $(u^*,v^*)$ exists
for this model and is given by $(u^*,v^*)=(a+b\,,\;b/(a+b)^2)$. Show that
the conditions for this steady state to be driven unstable by
diffusion are that the three inequalities
$$
b-a<(a+b)^3$$
$$
\left[D_2\left(\frac{b-a}{a+b}\right)-D_1(a+b)^2\right]^2>4D_1D_2(a+b)^2
$$ {#eq-turing2}
$$
D_2\left(\frac{b-a}{a+b}\right)-D_1(a+b)^2>0
$$ {#eq-turing3}
should all hold simultaneously.

:::

----------------------------------------------------------------------

#### * Conditions for Turing instability
::: {#exr-spatial6}

Consider the reaction-diffusion model
$$\begin{split}
\frac{\partial c_1}{\partial t}&=\delta -kc_1 - c_1c_2^2 + D_1\frac{\partial^2c_1}{\partial
  x^2} \\
\frac{\partial c_2}{\partial t}&=kc_1+c_1c_2^2 - c_2 + D_2\frac{\partial^2c_2}{\partial
  x^2}
\end{split}$$ {#eq-ex_turing4}
where $k>0$ and $\delta>0$.

Show that a spatially uniform steady state solution $(c_1^*,c_2^*)$ exists
for this model and  give the conditions for this steady state to be driven unstable by
diffusion. You may use any results derived in the lectures.

:::

----------------------------------------------------------------------

#### Slime mould with boundary
::: {#exr-spatial5}
In the model for the aggregation of slime mould amoebae
suppose that the spatial domain is $0\leq x\leq L$ rather than
$-\infty<x<\infty$. Show that the conditions for aggregation to occur
are $\chi a^*f>k\mu$ and
$$
L>\pi\sqrt{\frac{D\mu}{\chi a^* f-k\mu}}.
$$ {#eq-slime2}
:::
