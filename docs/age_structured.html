<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Work in progress">

<title>Mathematical Ecology and Epidemiology - 4&nbsp; Age-structured population model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sex_structured.html" rel="prev">
<link href="./virus.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Mathematical Ecology and Epidemiology - 4&nbsp; Age-structured population model">
<meta property="og:description" content="Work in progress">
<meta property="og:site_name" content="Mathematical Ecology and Epidemiology">
<meta name="twitter:title" content="Mathematical Ecology and Epidemiology - 4&nbsp; Age-structured population model">
<meta name="twitter:description" content="Work in progress">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./age_structured.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Age-structured population model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Mathematical Ecology and Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://maths.york.ac.uk/moodle/course/view.php?id=2656" title="Moodle page" class="quarto-navigation-tool px-1" aria-label="Moodle page"><i class="bi bi-mortarboard-fill"></i></a>
    <a href="https://forms.gle/naVqtYVGNqWmVDgRA" title="Submit a correction" class="quarto-navigation-tool px-1" aria-label="Submit a correction"><i class="bi bi-bug-fill"></i></a>
    <a href="https://github.com/gustavdelius/M3E-2024/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Mathematical-Ecology-and-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./continuous_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Continuous-time population models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discrete_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Discrete-time population models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sex_structured.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sex-structured population models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./age_structured.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Age-structured population model</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#continuous-time-model" id="toc-continuous-time-model" class="nav-link active" data-scroll-target="#continuous-time-model"><span class="header-section-number">4.1</span> Continuous time model</a></li>
  <li><a href="#discrete-time-model" id="toc-discrete-time-model" class="nav-link" data-scroll-target="#discrete-time-model"><span class="header-section-number">4.2</span> Discrete time model</a>
  <ul>
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description"><span class="header-section-number">4.2.1</span> Model description</a></li>
  <li><a href="#stable-age-distribution" id="toc-stable-age-distribution" class="nav-link" data-scroll-target="#stable-age-distribution"><span class="header-section-number">4.2.2</span> Stable age distribution</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">4.3</span> Exercises</a>
  <ul>
  <li><a href="#age-independent-rates" id="toc-age-independent-rates" class="nav-link" data-scroll-target="#age-independent-rates">* Age-independent rates</a></li>
  <li><a href="#o-harvestings-an-age-structured-population" id="toc-o-harvestings-an-age-structured-population" class="nav-link" data-scroll-target="#o-harvestings-an-age-structured-population">o Harvestings an age-structured population</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/gustavdelius/M3E-2024/edit/main/age_structured.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Age-structured population model</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="continuous-time-model" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="continuous-time-model"><span class="header-section-number">4.1</span> Continuous time model</h2>
<p>In the previous chapter we structured the population by a discrete variable, the sex of the individuals. This gave rise to a system of coupled ODEs, one ODE for each class of individuals. In this section we will structure the population by a continuous variable, the age of the individuals. This will give rise to a partial differential equation (PDE) for the age-dependent population density. We will solve this PDE and study the long-term behaviour of the population and its age distribution.</p>
<p>So instead of describing the population just by the total number of individuals <span class="math inline">\(N(t)\)</span>, we will describe it by the density <span class="math inline">\(n(t,a)\)</span> of individuals at age <span class="math inline">\(a\)</span>. The total number <span class="math inline">\(N(t)\)</span> of individuals in the population is then given by the integral of <span class="math inline">\(n(at,a)\)</span> over all ages. More generally, the total number of individuals in the population that are between age <span class="math inline">\(a_1\)</span> and <span class="math inline">\(a_2\)</span> is given by the integral of <span class="math inline">\(n(t,a)\)</span> over the interval <span class="math inline">\([a_1,a_2]\)</span>. You are familiar with the concept of density from probability theory, where continuous random variables are described by a probability density rather than a probability. You may also be familiar with the concept from physics, where the density of a material describes how the mass is distributed over space. Here, the density <span class="math inline">\(n(t,a)\)</span> describes how the individuals are distributed over ages.</p>
<p>To derive the PDE for the age-structured population density, we consider how the density changes over an infinitesimal time interval <span class="math inline">\(\delta t\)</span> due to deaths: <span id="eq-a1"><span class="math display">\[
n(t+\delta t, a+\delta t) = n(t,a) - \mu(a) n(t,a) \delta t.
\tag{4.1}\]</span></span> Note how we had to take into account that over the time interval <span class="math inline">\(\delta t\)</span> the age of the individuals has increased by <span class="math inline">\(\delta t\)</span>. We now Taylor-expand the left-hand side around <span class="math inline">\(t\)</span> and <span class="math inline">\(a\)</span>: <span id="eq-a2"><span class="math display">\[
n(t+\delta t, a+\delta t) = n(t,a) + \frac{\partial n}{\partial t} \delta t + \frac{\partial n}{\partial a} \delta t + \mathcal{O}(\delta t^2).
\tag{4.2}\]</span></span> Cancelling the <span class="math inline">\(n(t,a)\)</span> terms on both sides and dividing by <span class="math inline">\(\delta t\)</span> gives us the PDE for the age-structured population density: <span id="eq-a3"><span class="math display">\[
\frac{\partial n}{\partial t} + \frac{\partial n}{\partial a} = -\mu(a) n.
\tag{4.3}\]</span></span></p>
<p>This equation captures the effect of individuals aging and dying, but it does not capture how they are born. Individuals are born with age <span class="math inline">\(0\)</span>. These offspring can be produced by parents of any ages, but with an age-dependent rate <span class="math inline">\(b(a)\)</span>. This gives <span id="eq-a4"><span class="math display">\[
n(t,0) = \int_0^\infty b(a) n(t,a) \, da.
\tag{4.4}\]</span></span> This is a boundary condition for the PDE. It says that the density of individuals at age <span class="math inline">\(0\)</span> is given by the total number of offspring produced by the individuals of all ages.</p>
<p>We will now solve the PDE for the age-structured population density by the method of separation of variables. We will make the Ansatz <span class="math inline">\(n(t,a) = f(t) r(a)\)</span>. You have seen this trick for finding solutions of linear, homogeneous PDEs in other modules, like Waves and Fluids for example. Substituting this Ansatz into the PDE gives <span id="eq-a5"><span class="math display">\[
f'(t) r(a) + f(t) r'(a) = -\mu(a) f(t) r(a).
\tag{4.5}\]</span></span> Dividing by <span class="math inline">\(f(t) r(a)\)</span> gives <span id="eq-a6"><span class="math display">\[
\frac{f'(t)}{f(t)} + \frac{r'(a)}{r(a)} = -\mu(a).
\tag{4.6}\]</span></span> We now collect all terms that depend on <span class="math inline">\(t\)</span> on the left-hand side and all terms that depend on <span class="math inline">\(a\)</span> on the right-hand side: <span id="eq-a7"><span class="math display">\[
\frac{f'(t)}{f(t)} = - \frac{r'(a)}{r(a)} - \mu(a).
\tag{4.7}\]</span></span> Because the left-hand side is independent of <span class="math inline">\(a\)</span> and the right-hand side is independent of <span class="math inline">\(t\)</span>, both sides must be equal to a constant. We introduce the separation constant <span class="math inline">\(\gamma\)</span> and write <span id="eq-a8"><span class="math display">\[
\frac{f'(t)}{f(t)} = \gamma, \quad \frac{r'(a)}{r(a)} = -\gamma - \mu(a).
\tag{4.8}\]</span></span> These are now linear ODEs and hence easy to solve. The first ODE has the solution <span id="eq-a9"><span class="math display">\[
f(t) = f(0) e^{\gamma t}
\tag{4.9}\]</span></span> and the second ODE has the solution <span id="eq-a10"><span class="math display">\[
r(a) = r(0) \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right).
\tag{4.10}\]</span></span></p>
<p>So altogether we have the population density <span id="eq-a11"><span class="math display">\[
n(t,a) = n(0,0) e^{\gamma t} \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right),
\tag{4.11}\]</span></span> where <span class="math inline">\(n(0,0)=f(0)r(0)\)</span> is the initial density of individuals at age <span class="math inline">\(0\)</span>.</p>
<p>So far we don’t yet know the value of the separation constant <span class="math inline">\(\gamma\)</span>. This will be determined by the boundary condition. If we substitute the solution <a href="#eq-a11" class="quarto-xref">Eq.&nbsp;<span>4.11</span></a> into the boundary condition <a href="#eq-a4" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a>, we get <span id="eq-a12"><span class="math display">\[
n(0,0)e^{\gamma t} = \int_0^\infty b(a) n(0,0)e^{\gamma t} \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right)\, da.
\tag{4.12}\]</span></span> We can cancel the common factor <span class="math inline">\(n(0,0)e^{\gamma t}\)</span> on both sides to get the condition <span id="eq-a13"><span class="math display">\[
1= \int_0^\infty b(a) \exp\left(-\int_0^a \mu(a') \, da'-\gamma a\right) \, da = \phi(\gamma).
\tag{4.13}\]</span></span> We have introduced the shorthand notation <span class="math inline">\(\phi(\gamma)\)</span> for the integral on the right-hand side. The condition <a href="#eq-a12" class="quarto-xref">Eq.&nbsp;<span>4.12</span></a> is a transcendental equation for <span class="math inline">\(\gamma\)</span>. We cannot solve it analytically for <span class="math inline">\(\gamma\)</span>. But we observe that <span class="math inline">\(\phi\)</span> is a monotonically decreasing function of <span class="math inline">\(\gamma\)</span>. This observation alone allows us to make a statement about the sign of <span class="math inline">\(\gamma\)</span>. According to <a href="#eq-a9" class="quarto-xref">Eq.&nbsp;<span>4.9</span></a> the sign of <span class="math inline">\(\gamma\)</span> determines whether the total population grows expnentially or goes extinct.</p>
<p>If <span class="math inline">\(\gamma\)</span> is positive, then the monotonicity of <span class="math inline">\(\phi\)</span> tells us that <span class="math inline">\(\phi(0) &gt; \phi(\gamma)  = 1\)</span> and vice versa. Conversely, if <span class="math inline">\(\gamma\)</span> is negative, then <span class="math inline">\(\phi(0) &lt; \phi(\gamma) = 1\)</span> and vice versa. So to determine the sign of <span class="math inline">\(\gamma\)</span> we only have to look at the value of <span id="eq-a14"><span class="math display">\[
\phi(0) = \int_0^\infty b(a) \exp\left(-\int_0^a \mu(a') \, da'\right)\, da.
\tag{4.14}\]</span></span></p>
<ul>
<li><p>If <span class="math inline">\(\phi(0) &gt; 1\)</span>, then <span class="math inline">\(\gamma &gt; 0\)</span> and the population grows exponentially.</p></li>
<li><p>If <span class="math inline">\(\phi(0) &lt; 1\)</span>, then <span class="math inline">\(\gamma &lt; 0\)</span> and the population goes extinct.</p></li>
</ul>
<p>This result actually has a very intuitive explanation. The factor <span id="eq-a15"><span class="math display">\[
\exp\left(-\int_0^a \mu(a') \, da'\right)=:l(a)
\tag{4.15}\]</span></span> is the probability that an individual survives up to age <span class="math inline">\(a\)</span>. Therefore <span class="math inline">\(\phi(0)\)</span> is the expected number of offspring produced by an individual during its lifetime. If this number is greater than <span class="math inline">\(1\)</span>, then the population grows exponentially. If it is less than <span class="math inline">\(1\)</span>, then the population goes extinct.</p>
</section>
<section id="discrete-time-model" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="discrete-time-model"><span class="header-section-number">4.2</span> Discrete time model</h2>
<p>In the continuous-time age-structured population model discussed in the previous section we had assumed that births take place continuously through time. If however reproduction is an annual event, taking place in a short breeding season for example, then it is more natural to model the population in discrete time. We will now derive the discrete-time version of the age-structured population model and then study the long-term behaviour of the population and its age distribution.</p>
<section id="model-description" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="model-description"><span class="header-section-number">4.2.1</span> Model description</h3>
<p>Both time and age will be discrete variables. We will take them to be integers counting years. We will describe the population by the numbers <span class="math inline">\(N_{a,t}\)</span> of individuals of age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span>. The total number <span class="math inline">\(N_t\)</span> of individuals in the population at time <span class="math inline">\(t\)</span> is then given by the sum of <span class="math inline">\(N_{a,t}\)</span> over all ages.</p>
<p>The parameters of our model will be the probabilities <span class="math inline">\(S_a\)</span> of surviving from age <span class="math inline">\(a-1\)</span> to age <span class="math inline">\(a\)</span> and the number of offspring <span class="math inline">\(b_a\)</span> produced by an individual when they reach age <span class="math inline">\(a\)</span>. Because the number of individuals at age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t+1\)</span> is the number of individuals that a year earlier were at age <span class="math inline">\(a-1\)</span> and have survived to age <span class="math inline">\(a\)</span>, we have <span id="eq-a16"><span class="math display">\[
N_{a,t+1} = S_{a} N_{a-1,t}.
\tag{4.16}\]</span></span> When individuals reach age <span class="math inline">\(a\)</span>, they each produce <span class="math inline">\(b_a\)</span> offspring. The total number of offspring produced at time <span class="math inline">\(t\)</span> is therefore given by <span id="eq-a17"><span class="math display">\[
N_{0,t} = \sum_{a=1}^\infty b_a N_{a,t}.
\tag{4.17}\]</span></span> This is a boundary condition for the discrete-time model. It says that the number of individuals at age <span class="math inline">\(0\)</span> at time <span class="math inline">\(t\)</span> is given by the total number of offspring produced by the individuals of all ages at time <span class="math inline">\(t\)</span>. This is the discrete-time analogue of the boundary condition <a href="#eq-a4" class="quarto-xref">Eq.&nbsp;<span>4.4</span></a> for the continuous-time model.</p>
<p>Note that in <a href="#eq-a17" class="quarto-xref">Eq.&nbsp;<span>4.17</span></a> both sides of the equation are at time <span class="math inline">\(t\)</span>. That is because reproduction is taken to happen instantaneously at time <span class="math inline">\(t\)</span>. It is conventional to use <a href="#eq-a16" class="quarto-xref">Eq.&nbsp;<span>4.16</span></a> to rewrite the boundary condition <a href="#eq-a17" class="quarto-xref">Eq.&nbsp;<span>4.17</span></a> as an equation for <span class="math inline">\(N_{0,t+1}\)</span>: <span id="eq-a18"><span class="math display">\[
N_{0,t+1} = \sum_{a=1}^\infty b_a N_{a,t+1}= \sum_{a=1}^\infty b_a S_{a} N_{a-1,t}
= \sum_{a=1}^\infty F_a N_{a-1,t},
\tag{4.18}\]</span></span> where we have introduced the fecundity <span class="math inline">\(F_a:=b_a S_a\)</span>.</p>
<p><a href="#eq-a16" class="quarto-xref">Eq.&nbsp;<span>4.16</span></a> and <a href="#eq-a18" class="quarto-xref">Eq.&nbsp;<span>4.18</span></a> are the equations for the discrete-time age-structured population model. They are a system of coupled difference equations, one equation for each age class. We would like to solve them to determine the numbers <span class="math inline">\(N_{a,t}\)</span> of individuals at each age at each time. Notice that <a href="#eq-a16" class="quarto-xref">Eq.&nbsp;<span>4.16</span></a> looks very simple and we could use it to determine <span class="math inline">\(N_{a,t}\)</span> for <span class="math inline">\(a=1,2,3,\ldots\)</span> in terms of <span class="math inline">\(N_{0,t}\)</span>, <span id="eq-ac18"><span class="math display">\[
\begin{split}
N_{a,t} &amp;= S_{a} N_{a-1,t} = S_{a} S_{a-1} N_{a-2,t} = \cdots \\
&amp;= S_aS_{a-1}\cdots S_1 N_{0,t}
= l_{a} N_{0,t},
\end{split}
\tag{4.19}\]</span></span> where we used that the product <span class="math inline">\(S_aS_{a-1}\cdots S_1\)</span> is the probability of surviving from age <span class="math inline">\(0\)</span> to age <span class="math inline">\(a\)</span>, which we denote by <span class="math inline">\(l_a\)</span>. However <a href="#eq-a18" class="quarto-xref">Eq.&nbsp;<span>4.18</span></a> spoils the game because it tells us that we won’t know <span class="math inline">\(N_{0,t}\)</span> until we know <span class="math inline">\(N_{a,t}\)</span> for all ages <span class="math inline">\(a\)</span>. This is a typical feature of age-structured population models. The number of individuals at age <span class="math inline">\(0\)</span> at time <span class="math inline">\(t\)</span> depends on the number of individuals at all other ages at time <span class="math inline">\(t\)</span>. Solving both <a href="#eq-a16" class="quarto-xref">Eq.&nbsp;<span>4.16</span></a> and <a href="#eq-a18" class="quarto-xref">Eq.&nbsp;<span>4.18</span></a> together is a non-trivial task.</p>
</section>
<section id="stable-age-distribution" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="stable-age-distribution"><span class="header-section-number">4.2.2</span> Stable age distribution</h3>
<p>In analogy to the continuous-time model, we will now look for a solution of the form <span id="eq-ab19"><span class="math display">\[
N_{a,t} = \lambda^t r(a)
\tag{4.20}\]</span></span> This is a solution in which the age distribution <span class="math inline">\(r(a)\)</span> remains stable from one year to the next, but the total population grows or shrinks by a factor <span class="math inline">\(\lambda\)</span> each year. This means in particular that for this solution <span class="math inline">\(N_{a,t+1} = \lambda N_{a,t}\)</span> for all ages <span class="math inline">\(a\)</span>. For <span class="math inline">\(a=1\)</span> this gives <span id="eq-a23"><span class="math display">\[
N_{1,t+1} = \lambda N_{1,t} = S_1 N_{0,t}
\tag{4.21}\]</span></span> and hence <span id="eq-a24"><span class="math display">\[
N_{1,t} = \frac{S_1}{\lambda} N_{0,t}.
\tag{4.22}\]</span></span> Similarly we can express <span class="math inline">\(N_{2,t}\)</span> in terms of <span class="math inline">\(N_{0,t}\)</span>: <span id="eq-a25"><span class="math display">\[
N_{2,t} = \frac{S_2}{\lambda} N_{1,t} = \frac{S_1 S_2}{\lambda^2} N_{0,t}.
\tag{4.23}\]</span></span> We can continue this process to express <span class="math inline">\(N_{a,t}\)</span> in terms of <span class="math inline">\(N_{0,t}\)</span>: <span id="eq-a26"><span class="math display">\[
N_{a,t} = \frac{S_1 S_2 \cdots S_{a}}{\lambda^a} N_{0,t}= \frac{l_{a}}{\lambda^a} N_{0,t}.
\tag{4.24}\]</span></span></p>
<p>Finally, for the newborns we have <span id="eq-a27"><span class="math display">\[
N_{0,t+1} = \lambda N_{0,t} = \sum_{a=1}^M F_a N_{a-1,t} = \sum_{a=1}^M F_a \frac{l_{a-1}}{\lambda^{a-1}} N_{0,t}.
\tag{4.25}\]</span></span> Dividing the equation by <span class="math inline">\(\lambda N_{0,t}\)</span> gives <span id="eq-a28"><span class="math display">\[
1 = \sum_{a=1}^M F_a\frac{l_{a-1}}{\lambda^a}.
\tag{4.26}\]</span></span> Using that <span class="math inline">\(F_a = b_a S_a\)</span> and <span class="math inline">\(S_al_{a-1}=l_a\)</span> we can rewrite this equation as <span id="eq-a29"><span class="math display">\[
1 = \sum_{a=1}^M b_a \,l_a\,\lambda^{-a} =:\psi(\lambda).
\tag{4.27}\]</span></span> This is the Euler-Lotka equation for the stable age distribution. Compare it to the corresponding equation for the continuous-time model <a href="#eq-a13" class="quarto-xref">Eq.&nbsp;<span>4.13</span></a> with <span class="math inline">\(e^{\gamma}=\lambda\)</span>. The only difference is that the continuous-time model has an integral over age, while the discrete-time model has a sum over age.</p>
<p>By the same argument as in the continuous case we can see that if the expected number of offspring produced by an individual during its lifetime, <span class="math inline">\(\sum_{a=1}^M b_a \,l_a=\psi(1)\)</span>, is greater than <span class="math inline">\(1\)</span> then the population grows exponentially. If it is less than <span class="math inline">\(1\)</span>, then the population goes extinct.</p>
<p>We will now determine the stable age distribution for a specific example.</p>
<div id="exm-spotted_owl" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.1</strong></span> For the spotted owl the age-dependent reproduction numbers are <span id="eq-a30"><span class="math display">\[
b_a = \begin{cases}
0 &amp; \text{if } a &lt; 2, \\
b &amp; \text{if } a \geq 2
\end{cases}
\tag{4.28}\]</span></span> for some constant <span class="math inline">\(b\)</span>. The age-dependent survival probabilities are <span id="eq-a31"><span class="math display">\[
S_a = \begin{cases}
1 &amp; \text{if } a = 1, \\
l &amp; \text{if } a = 2, \\
p &amp; \text{if } a &gt; 2
\end{cases}
\tag{4.29}\]</span></span> for some constants <span class="math inline">\(l\)</span> and <span class="math inline">\(p\)</span>. Those values of the survival probabilities from year to year lead to the following values of the survival probabilities from birth to age <span class="math inline">\(a\)</span>: <span id="eq-a32"><span class="math display">\[
l_a = \begin{cases}
1 &amp; \text{if } a = 1, \\
l\, p^{a-2} &amp; \text{if } a \geq 2.
\end{cases}
\tag{4.30}\]</span></span> Substituting these values into the expression for <span class="math inline">\(\psi(\lambda)\)</span> in <a href="#eq-a29" class="quarto-xref">Eq.&nbsp;<span>4.27</span></a> gives <span id="eq-a33"><span class="math display">\[
\begin{split}
\psi(\lambda) &amp;= b l \sum_{a=2}^\infty p^{a-2} \lambda^{-a} = lb\lambda^{-2}\sum_{n=0}^\infty \frac{p}{\lambda}\\
&amp;= lb\lambda^{-2}\frac{1}{1-\frac{p}{\lambda}}
=\frac{lb}{\lambda(\lambda-p)},
\end{split}
\tag{4.31}\]</span></span> where we made use of the formula for a geometric series, valid if <span class="math inline">\(|p/\lambda|&lt;1\)</span> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. In particular, the expected number of offspring produced by an individual in their lifetime is <span class="math display">\[
\psi(1)=lb/(1-p).
\]</span> If this is greater than <span class="math inline">\(1\)</span>, then the population grows exponentially. If it is less than <span class="math inline">\(1\)</span>, then the population goes extinct.</p>
<p>In this case the Euler-Lotka equation <span class="math inline">\(\psi(\lambda)=1\)</span> becomes the quadratic equation for <span class="math inline">\(\lambda\)</span>: <span id="eq-a34"><span class="math display">\[
\psi(\lambda)=\frac{lb}{\lambda(\lambda-p)}=1 \quad \Leftrightarrow \quad \lambda^2 - \lambda p - lb = 0.
\tag{4.32}\]</span></span> The solutions are <span id="eq-a35"><span class="math display">\[
\lambda_\pm = \frac{p \pm \sqrt{p^2 + 4lb}}{2}.
\tag{4.33}\]</span></span> We are interested in the positive solution <span class="math inline">\(\lambda_+\)</span>. Substituting this value for <span class="math inline">\(\lambda\)</span> back into <a href="#eq-a26" class="quarto-xref">Eq.&nbsp;<span>4.24</span></a> and <a href="#eq-ab19" class="quarto-xref">Eq.&nbsp;<span>4.20</span></a> we see that we have found the solution <span id="eq-a36"><span class="math display">\[
N_{a,t} = \left(\frac{p + \sqrt{p^2 + 4lb}}{2}\right)^{t-a}l_a N_{0,0}
\tag{4.34}\]</span></span> for any choice of <span class="math inline">\(N_{0,0}\)</span>.</p>
</div>
<!----
In the case where there is a maximal age $M$, we can collect the equations for $N_{a,t+1}$ for $a=0,1,2,\ldots,M-1$ (@eq-a16 and @eq-a18) into a matrix equation:

$$
\begin{pmatrix}
N_{0} \\
N_{1} \\
N_{2} \\
\vdots \\
N_{M-1}
\end{pmatrix}_{t+1}
=
\begin{pmatrix}
F_1 & F_2 & \cdots & F_{M-1} & F_M \\
S_1 & 0 & \cdots & 0 & 0 \\
0 & S_2 & \cdots & 0 & 0 \\
\vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & \cdots & S_{M-1} & 0
\end{pmatrix}
\begin{pmatrix}
N_{0} \\
N_{1} \\
N_{2} \\
\vdots \\
N_{M-1}
\end{pmatrix}_{t}.
$$ {#eq-a19}

Note that we did not include the equation for $N_{M,t+1}$ in the matrix equation. This is because individuals at age $M$ are assumed to die at the end of the year before they get a chance to reproduce, hence they do not contribute back to the other age classes. Once the matrix equation @eq-a19 is solved, we can determine $N_{M,t+1}$ separately from @eq-a16 if we are interested.

The matrix on the right-hand side of @eq-a19 is a so-called Leslie matrix. Let us denote it by $L$. The equation @eq-a19 is a matrix equation of the form
$$
\mathbf{N}_{t+1} = L\, \mathbf{N}_t,
$$ {#eq-a20}
where $\mathbf{N}_t$ is the column vector of the numbers $N_{a,t}$ and $L$ is the Leslie matrix. 

In this notation it is easy to formally write down the solution:
$$
\mathbf{N}_t = L^t \mathbf{N}_0.
$$ {#eq-a21}


Next we want to look at the stable age distribution of the population. This is a distribution of the population over ages that remains unchanged from one year to the next. It is the distribution that the population will eventually settle into, no matter what the initial distribution was. The total population may still change by a factor $\lambda$ each year, but this factor changes the population at all ages equally. This stable age distribution therefore has to satisfy the equation
$$
\mathbf{N}_{t+1} = L\, \mathbf{N}_t = \lambda\,\mathbf{N}_{t},
$$ {#eq-a22}
In other words, it is an eigenvector of the Leslie matrix with real eigenvalue $\lambda$.


---->
</section>
</section>
<section id="exercises" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="exercises"><span class="header-section-number">4.3</span> Exercises</h2>
<section id="age-independent-rates" class="level4">
<h4 class="anchored" data-anchor-id="age-independent-rates">* Age-independent rates</h4>
<div id="exr-age_structured" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.1</strong></span> In the continuous-time age-structured population model consider the case where <span class="math inline">\(b(a)=b\)</span> and <span class="math inline">\(\mu(a)=\mu\)</span> are both constant. Repeat all steps of the analysis but simplifying the expressions at each step by using the constant values for birth and death rates.</p>
<ol type="1">
<li>Solve the partial differential equation of the age-structured model by making the Ansatz <span class="math inline">\(n(t,a)=f(t)r(a)\)</span> and introducing the separation constant <span class="math inline">\(\gamma\)</span>.</li>
<li>Use the boundary condition at <span class="math inline">\(a=0\)</span> to determine the value of <span class="math inline">\(\gamma\)</span>.</li>
<li>Give the condition under which the population goes extinct and compare it to the condition in the exponential model from chapter 1.</li>
</ol>
</div>
</section>
<section id="o-harvestings-an-age-structured-population" class="level4">
<h4 class="anchored" data-anchor-id="o-harvestings-an-age-structured-population">o Harvestings an age-structured population</h4>
<div id="exr-age_harvesting" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.2</strong></span> Consider an age-structured fish population in which all individuals above the maturity age <span class="math inline">\(a_m\)</span> are reproducing, at a fixed rate, so that <span id="eq-age_harvesting_1"><span class="math display">\[
b(a) = \begin{cases}
0 &amp; \text{if } a &lt; a_m, \\
b &amp; \text{if } a \geq a_m.
\end{cases}
\tag{4.35}\]</span></span> All fish at all ages experience a natural death rate <span class="math inline">\(\mu_0\)</span>. In addition, fish above the maturity size are harvested at a constant rate <span class="math inline">\(\mu_F\)</span>, so that <span id="eq-age_harvesting_2"><span class="math display">\[
\mu(a) = \begin{cases}
\mu_0 &amp; \text{if } a &lt; a_m, \\
\mu_0 + \mu_F &amp; \text{if } a \geq a_m.
\end{cases}
\tag{4.36}\]</span></span> By calculating the expected number of offspring per individual, determine the limit on the harvesting rate <span class="math inline">\(\mu_F\)</span> that allows the population to be sustainable.</p>
</div>
<!----
#### o Leslie matrix
::: {#exr-leslie}
Consider the Leslie matrix
$$
L = \begin{pmatrix}
0 & 2 & 0 \\
0.5 & 0 & 0 \\
0 & 0.5 & 0
\end{pmatrix}.
$$ {#eq-leslie}

1. Calculate the stable age distribution of the population.
2. Calculate the growth rate of the population.
:::

#### o Leslie matrix with harvesting
::: {#exr-leslie_harvesting}
Consider the Leslie matrix
$$
L = \begin{pmatrix}
0 & 2 & 0 \\
0.5 & 0 & 0 \\
0 & 0.5 & 0
\end{pmatrix}.
$$ {#eq-leslie_harvesting}
Now assume that the population is harvested at a constant rate $\mu_F$ at all ages. The harvesting rate is such that
$$
\mu(a) = \begin{cases}
\mu_0 & \text{if } a < a_m, \\
\mu_0 + \mu_F & \text{if } a \geq a_m.
\end{cases}
$$ {#eq-leslie_harvesting_2}
Calculate the stable age distribution of the population and the growth rate of the population.
:::

#### o Leslie matrix with age-independent rates
::: {#exr-leslie_age_independent}
Consider the Leslie matrix
$$
L = \begin{pmatrix}
0 & 2 & 0 \\
0.5 & 0 & 0 \\
0 & 0.5 & 0
\end{pmatrix}.
$$ {#eq-leslie_age_independent}
Now assume that the birth and death rates are constant, so that
$$
b(a) = b, \quad \mu(a) = \mu.
$$ {#eq-leslie_age_independent_2}
Calculate the stable age distribution of the population and the growth rate of the population.
:::

#### Eastern Screech Owl
::: {#exr-owl}
The Eastern Screech Owl is a small owl that is found in the eastern United States and Canada. It is a cavity-nesting bird, which means that it nests in holes in trees. The Eastern Screech Owl has a lifespan of about 10 years. It reaches maturity at 1 year and has a clutch size of 3-5 eggs. The Eastern Screech Owl is a nocturnal bird and feeds on small mammals, birds, and insects. It is a common bird in its range and is not considered to be threatened.

| Age | Suburban     |           | Rural        |           |
| --- | ------------ | --------- | ------------ | --------- |
| $a$ |   $l_a$      |   $m_a$   |   $l_a$      |   $m_a$   |
| 0   | 1.00         | 0.0       | 1.00         | 0.0       |
| 1   | 0.49         | 0.8       | 0.30         | 0.8       |
| 2   | 0.18         | 1.3       | 0.11         | 1.1       |
| 3   | 0.10         | 1.5       | 0.06         | 1.6       |
| 4   | 0.06         | 1.6       | 0.04         | 1.0       |
| 5   | 0.04         | 1.3       | 0.02         | 1.0       |
| 6   | 0.03         | 1.3       |              |           |
| 7   | 0.02         | 1.3       |              |           |
| 8   | 0.02         | 1.3       |              |           |
| 9   | 0.01         | 1.3       |              |           |
| 10  | 0.01         | 1.3       |              |           |

1. Use the Leslie matrix model to calculate the stable age distribution of the Eastern Screech Owl population.
2. Calculate the growth rate of the Eastern Screech Owl population.
:::

---->


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>If <span class="math inline">\(\lambda\geq p\)</span>, then <span class="math inline">\(\psi(\lambda)\)</span> diverges and does not satisfy the Euler-Lotka equation <span class="math inline">\(\psi(\lambda)=1\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./sex_structured.html" class="pagination-link  aria-label=" &lt;span="" population="" models&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sex-structured population models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/gustavdelius/M3E-2024/edit/main/age_structured.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>